import{j as e,C as j,a as N,d as p,b as k,c as E}from"./ui-DCtcd1Kk.js";import{r as g}from"./router-C32cmwfs.js";import{a as R,u as J,t as Q}from"./index-XEsyHGvM.js";import{D as Z}from"./DashboardLayout-gnvqe74Z.js";import{T as ee,a as te,b as O,c as B}from"./tabs-BP-itumS.js";import{S}from"./skeleton-BbxErKBh.js";import{a as F,f as A,p as H,c as se,b as ae}from"./utils-DCNUdSfE.js";import{a as K,B as re,C as W,X as Y,Y as U,T as P,L as _,b as G,P as ne,d as oe,e as ce,f as le,g as L}from"./charts-BMSya-r6.js";import{B as V}from"./badge-CCKXs842.js";import{a as ie,A as ue}from"./arrow-up-Beua0blQ.js";import{C as me}from"./Sidebar-CR8TwwPA.js";import{c as X}from"./RootLayout-Bf31PLGy.js";import"./react-Csw2ODfV.js";import"./arrow-right-left-DbfiJvWz.js";/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]],fe=X("chart-line",de);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],xe=X("chart-pie",he),ge=({transactions:t,isLoading:f})=>{const{theme:x}=R(),n=x==="dark",c={inflow:n?"#4ade80":"#22c55e",outflow:n?"#f87171":"#ef4444",grid:n?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)",text:n?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.7)"},i=({active:r,payload:s,label:o})=>r&&s&&s.length?e.jsxs("div",{className:se("rounded-md border p-3 shadow-md","bg-background/95 text-foreground","border-border"),children:[e.jsxs("p",{className:"font-medium mb-1",children:["Date: ",o]}),s.map((u,m)=>e.jsxs("p",{className:"text-sm flex items-center gap-2 py-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-full inline-block",style:{backgroundColor:u.color}}),e.jsxs("span",{className:"font-medium",children:[u.name,":"," ",new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(u.value)]})]},`item-${m}`))]}):null,a=g.useMemo(()=>{if(!t.length)return[];const r=Array.from({length:30},(o,u)=>{const m=F(new Date,u);return{date:A(m,"yyyy-MM-dd"),label:A(m,"MMM dd"),inflow:0,outflow:0}}).reverse(),s=new Map(r.map(o=>[o.date,{...o}]));return t.forEach(o=>{try{const u=A(H(o.timestamp),"yyyy-MM-dd"),m=s.get(u);m&&(o.fromAccountNumber&&!o.toAccountNumber?m.outflow+=o.amount:!o.fromAccountNumber&&o.toAccountNumber?m.inflow+=o.amount:o.fromAccountNumber&&o.toAccountNumber&&(m.outflow+=o.amount,m.inflow+=o.amount))}catch(u){console.error("Error processing transaction:",u)}}),Array.from(s.values())},[t]);return f?e.jsx(S,{className:"h-full w-full"}):t.length===0?e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No transaction data available"})}):e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(re,{data:a,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(W,{strokeDasharray:"3 3",stroke:c.grid}),e.jsx(Y,{dataKey:"label",tick:{fontSize:12,fill:c.text},interval:Math.floor(a.length/7)}),e.jsx(U,{tickFormatter:r=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",notation:"compact",compactDisplay:"short",maximumFractionDigits:1}).format(r).replace("T","k"),tick:{fill:c.text}}),e.jsx(P,{content:e.jsx(i,{}),cursor:{fill:n?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)"}}),e.jsx(_,{wrapperStyle:{color:c.text}}),e.jsx(G,{dataKey:"inflow",name:"Money In",fill:c.inflow,radius:[4,4,0,0]}),e.jsx(G,{dataKey:"outflow",name:"Money Out",fill:c.outflow,radius:[4,4,0,0]})]})})},be=t=>(t=t.toLowerCase(),t.includes("grocery")||t.includes("supermarket")?"Groceries":t.includes("restaurant")||t.includes("food")||t.includes("dinner")?"Dining":t.includes("transfer")?"Transfers":t.includes("bill")||t.includes("utility")?"Bills":t.includes("transport")||t.includes("uber")||t.includes("ola")?"Transportation":t.includes("shopping")||t.includes("amazon")||t.includes("flipkart")?"Shopping":t.includes("entertainment")||t.includes("movie")||t.includes("subscription")?"Entertainment":"Other"),ye=({transactions:t,isLoading:f})=>{const{theme:x}=R(),n=x==="dark",c=n?["#60a5fa","#4ade80","#fbbf24","#f87171","#c084fc","#94a3b8","#67e8f9","#fda4af"]:["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#64748b","#06b6d4","#f43f5e"],i=g.useMemo(()=>{if(!t.length)return[];const a={};return t.filter(r=>r.fromAccountNumber!==null).forEach(r=>{const s=be(r.description||"Other");a[s]=(a[s]||0)+r.amount}),Object.entries(a).map(([r,s])=>({name:r,value:s}))},[t]);return f?e.jsx(S,{className:"h-full w-full"}):i.length===0?e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No spending data available"})}):e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ne,{children:[e.jsx(oe,{data:i,cx:"50%",cy:"50%",labelLine:!0,outerRadius:150,fill:"#8884d8",dataKey:"value",nameKey:"name",label:({name:a,percent:r})=>`${a} ${(r*100).toFixed(0)}%`,children:i.map((a,r)=>e.jsx(ce,{fill:c[r%c.length]},`cell-${r}`))}),e.jsx(P,{formatter:a=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(a),contentStyle:{backgroundColor:n?"#1f2937":"#ffffff",borderColor:n?"#374151":"#e5e7eb",color:n?"#f3f4f6":"#111827"},itemStyle:{color:n?"#f3f4f6":"#111827"}}),e.jsx(_,{wrapperStyle:{color:n?"#e5e7eb":"#111827"}})]})})},je=({accounts:t,transactions:f,isLoading:x})=>{const{theme:n}=R(),c=n==="dark",i={total:c?"#a78bfa":"#8b5cf6",savings:c?"#4ade80":"#22c55e",checking:c?"#fbbf24":"#f59e0b",grid:c?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)",text:c?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.7)"},a=g.useMemo(()=>{if(!t.length||!f.length)return[];const s=30,o=ae(new Date),u={};t.forEach(h=>{u[h.accountNumber]=h.balance});const m=[...f].sort((h,M)=>new Date(M.timestamp).getTime()-new Date(h.timestamp).getTime()),l=Array.from({length:s+1},(h,M)=>{const D=F(o,s-M);return{date:A(D,"yyyy-MM-dd"),label:A(D,"MMM dd"),total:0,savings:0,checking:0}}),v=new Map(l.map(h=>[h.date,h]));for(let h=s;h>=0;h--){const M=F(o,h),D=A(M,"yyyy-MM-dd"),d=v.get(D);if(h===s){t.forEach(w=>{w.type.includes("SAVING")?d.savings+=w.balance:d.checking+=w.balance}),d.total=d.savings+d.checking;continue}const q=A(F(M,1),"yyyy-MM-dd"),z=v.get(q);d.savings=z.savings,d.checking=z.checking,m.filter(w=>A(H(w.timestamp),"yyyy-MM-dd")===D).forEach(w=>{const{fromAccountNumber:T,toAccountNumber:I,amount:b}=w;if(T&&I){const y=t.find($=>$.accountNumber===T),C=t.find($=>$.accountNumber===I);y&&C&&(y.type.includes("SAVING")?d.savings-=b:d.checking-=b,C.type.includes("SAVING")?d.savings+=b:d.checking+=b)}else if(T){const y=t.find(C=>C.accountNumber===T);y&&(y.type.includes("SAVING")?d.savings-=b:d.checking-=b)}else if(I){const y=t.find(C=>C.accountNumber===I);y&&(y.type.includes("SAVING")?d.savings+=b:d.checking+=b)}}),d.total=d.savings+d.checking}return l},[t,f]);if(x)return e.jsx(S,{className:"h-full w-full"});if(a.length===0)return e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No balance history data available"})});const r=s=>Math.abs(s)>=1e6?`₹${(s/1e6).toFixed(1)}M`:Math.abs(s)>=1e3?`₹${(s/1e3).toFixed(1)}k`:`₹${s.toFixed(0)}`;return e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(le,{data:a,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(W,{strokeDasharray:"3 3",stroke:i.grid}),e.jsx(Y,{dataKey:"label",tick:{fontSize:12,fill:i.text},interval:Math.floor(a.length/10)}),e.jsx(U,{tickFormatter:r,tick:{fill:i.text}}),e.jsx(P,{formatter:s=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(s),labelFormatter:s=>`Date: ${s}`,contentStyle:{backgroundColor:c?"#1f2937":"#ffffff",borderColor:c?"#374151":"#e5e7eb",color:c?"#f3f4f6":"#111827"},itemStyle:{color:c?"#f3f4f6":"#111827"}}),e.jsx(_,{wrapperStyle:{color:i.text}}),e.jsx(L,{type:"monotone",dataKey:"total",name:"Total Balance",stroke:i.total,strokeWidth:3,dot:!1,activeDot:{r:8}}),e.jsx(L,{type:"monotone",dataKey:"savings",name:"Savings Accounts",stroke:i.savings,strokeWidth:2,dot:!1}),e.jsx(L,{type:"monotone",dataKey:"checking",name:"Checking Accounts",stroke:i.checking,strokeWidth:2,dot:!1})]})})},Ne=({transactions:t,accounts:f,isLoading:x})=>{const n=g.useMemo(()=>{if(!t.length||!f.length)return{totalIncoming:0,totalOutgoing:0,avgTransactionAmount:0,largestTransaction:0,transactionCount:0,mostActiveAccount:{accountNumber:"",count:0}};let a=0,r=0;const s={};let o=0;const u=new Set(f.map(l=>l.accountNumber));t.forEach(l=>{l.fromAccountNumber&&u.has(l.fromAccountNumber)&&(r+=l.amount,s[l.fromAccountNumber]=(s[l.fromAccountNumber]||0)+1),l.toAccountNumber&&u.has(l.toAccountNumber)&&(a+=l.amount,s[l.toAccountNumber]=(s[l.toAccountNumber]||0)+1),l.amount>o&&(o=l.amount)});let m={accountNumber:"",count:0};return Object.entries(s).forEach(([l,v])=>{v>m.count&&(m={accountNumber:l,count:v})}),{totalIncoming:a,totalOutgoing:r,avgTransactionAmount:(a+r)/(t.length||1),largestTransaction:o,transactionCount:t.length,mostActiveAccount:m}},[t,f]),c=a=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(a),i=()=>{if(!n.mostActiveAccount.accountNumber)return"No activity";const a=f.find(r=>r.accountNumber===n.mostActiveAccount.accountNumber);return a?`${a.type} (${a.accountNumber.slice(-4)})`:n.mostActiveAccount.accountNumber};return x?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[...Array(4)].map((a,r)=>e.jsxs(j,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(S,{className:"h-5 w-40"})}),e.jsx(p,{children:e.jsx(S,{className:"h-8 w-28"})})]},r))}):e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(j,{children:[e.jsx(N,{className:"pb-2",children:e.jsxs(k,{className:"text-sm font-medium",children:["Money In",e.jsxs(V,{className:"ml-2 bg-green-500",children:[e.jsx(ie,{className:"h-3 w-3 mr-1"}),"Inflow"]})]})}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:c(n.totalIncoming)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total incoming transactions"})]})]}),e.jsxs(j,{children:[e.jsx(N,{className:"pb-2",children:e.jsxs(k,{className:"text-sm font-medium",children:["Money Out",e.jsxs(V,{variant:"outline",className:"ml-2",children:[e.jsx(ue,{className:"h-3 w-3 mr-1"}),"Outflow"]})]})}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:c(n.totalOutgoing)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total outgoing transactions"})]})]}),e.jsxs(j,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(k,{className:"text-sm font-medium",children:"Transaction Stats"})}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n.transactionCount}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Avg: ",c(n.avgTransactionAmount)]})]})]}),e.jsxs(j,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(k,{className:"text-sm font-medium",children:"Most Active Account"})}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:i()}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[n.mostActiveAccount.count," transactions"]})]})]})]})},Be=()=>{const{user:t}=J(),[f,x]=g.useState([]),[n,c]=g.useState([]),[i,a]=g.useState(!0),[r,s]=g.useState("transactions");g.useEffect(()=>{t!=null&&t.id&&o()},[t]);const o=async()=>{a(!0);try{const u=localStorage.getItem("token"),m=await fetch(`/api/users/${t==null?void 0:t.id}/transactions`,{headers:{Authorization:`Bearer ${u}`}}),l=await fetch(`/api/users/${t==null?void 0:t.id}/accounts`,{headers:{Authorization:`Bearer ${u}`}});if(!m.ok||!l.ok)throw new Error("Failed to fetch analytics data");const v=await m.json(),h=await l.json();x(v),c(h)}catch(u){console.error("Error fetching analytics data:",u),Q.error("Failed to load analytics data")}finally{a(!1)}};return e.jsx(Z,{children:e.jsxs("div",{className:"flex-1 space-y-4 p-4 pt-6 md:p-8",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Analytics"})}),e.jsxs(ee,{value:r,onValueChange:s,className:"space-y-4",children:[e.jsxs(te,{children:[e.jsxs(O,{value:"transactions",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Transactions"]}),e.jsxs(O,{value:"spending",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Spending Categories"]}),e.jsxs(O,{value:"balance",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Balance History"]})]}),e.jsxs(B,{value:"transactions",className:"space-y-4",children:[e.jsxs(j,{children:[e.jsxs(N,{children:[e.jsx(k,{children:"Transaction Patterns"}),e.jsx(E,{children:"Your transaction activity over time"})]}),e.jsx(p,{className:"h-96",children:e.jsx(ge,{transactions:f,isLoading:i})})]}),e.jsx(Ne,{transactions:f,accounts:n,isLoading:i})]}),e.jsx(B,{value:"spending",className:"space-y-4",children:e.jsxs(j,{children:[e.jsxs(N,{children:[e.jsx(k,{children:"Spending by Category"}),e.jsx(E,{children:"How your spending is distributed by category"})]}),e.jsx(p,{className:"h-96",children:e.jsx(ye,{transactions:f,isLoading:i})})]})}),e.jsx(B,{value:"balance",className:"space-y-4",children:e.jsxs(j,{children:[e.jsxs(N,{children:[e.jsx(k,{children:"Balance History"}),e.jsx(E,{children:"Your account balance trends over time"})]}),e.jsx(p,{className:"h-96",children:e.jsx(je,{accounts:n,transactions:f,isLoading:i})})]})})]})]})})};export{Be as default};
