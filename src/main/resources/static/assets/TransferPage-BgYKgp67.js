import{j as e,C as Y,a as H,b as G,c as K,d as Q,B as D,e as U}from"./ui-DCtcd1Kk.js";import{r as b}from"./router-C32cmwfs.js";import{u as P,o as q,s as x}from"./utils-DCNUdSfE.js";import{A as W,C as X,a as Z,F as V,b as i,c as l,d,e as u,g,f as m,s as $}from"./alert-CsIf4CTI.js";import{u as ee,t as h}from"./index-XEsyHGvM.js";import{D as re}from"./DashboardLayout-gnvqe74Z.js";import{S,a as v,b as I,c as E,d as F}from"./select-gkOMAzdD.js";import{I as A}from"./input-DjdrYohH.js";import{f as C}from"./formatters-CGbyXkBS.js";import{T as se,a as ne,b as B,c as M}from"./tabs-BP-itumS.js";import{A as O}from"./arrow-right-B-WtKbaQ.js";import"./charts-BMSya-r6.js";import"./react-Csw2ODfV.js";import"./RootLayout-Bf31PLGy.js";import"./Sidebar-CR8TwwPA.js";import"./arrow-right-left-DbfiJvWz.js";const te=q({fromAccountId:x({required_error:"Please select a source account"}),toAccountNumber:x().min(1,"Please enter the destination account number"),amount:x().min(1,"Amount is required").refine(n=>{const t=parseFloat(n);return!isNaN(t)&&t>0},{message:"Amount must be positive"}),description:x().optional()}),oe=q({fromAccountId:x({required_error:"Please select a source account"}),toAccountId:x({required_error:"Please select a destination account"}).refine(n=>n!==void 0,{message:"Please select a destination account"}),amount:x().min(1,"Amount is required").refine(n=>{const t=parseFloat(n);return!isNaN(t)&&t>0},{message:"Amount must be positive"}),description:x().optional()}),Ne=()=>{const{user:n}=ee(),[t,L]=b.useState([]),[y,N]=b.useState(!1),[k,w]=b.useState(null),[z,_]=b.useState("external"),j=P({resolver:$(te),defaultValues:{description:""}}),f=P({resolver:$(oe),defaultValues:{description:"Transfer between own accounts"}});b.useEffect(()=>{(async()=>{if(n)try{const r=localStorage.getItem("token"),a=await fetch(`/api/users/${n.id}/accounts`,{headers:{Authorization:`Bearer ${r}`}});if(!a.ok)throw new Error(`Error: ${a.status}`);const p=await a.json();L(p)}catch(r){console.error("Error fetching accounts:",r),h.error("Failed to load accounts")}})()},[n]);const J=async s=>{if(!n){h.error("You must be logged in to make transfers");return}N(!0),w(null);try{const r={fromAccountId:parseInt(s.fromAccountId),toAccountNumber:s.toAccountNumber,amount:parseFloat(s.amount),description:s.description||"External transfer"};console.log("Making transfer with data:",r);const a=localStorage.getItem("token"),p=await fetch(`/api/users/${n.id}/transfers`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(r)});if(!p.ok){let c="Failed to process transfer";try{const o=await p.json();c=o.message||o.error||c}catch{c=`Error: ${p.status}`}throw new Error(c)}h.success("Transfer completed successfully!"),j.reset()}catch(r){console.error("Error making transfer:",r),w(r.message||"An unexpected error occurred"),h.error("Transfer failed")}finally{N(!1)}},R=async s=>{if(!n){h.error("You must be logged in to make transfers");return}if(s.fromAccountId===s.toAccountId){h.error("Source and destination accounts cannot be the same");return}N(!0),w(null);try{const r=t.find(o=>o.id===parseInt(s.toAccountId));if(!r)throw new Error("Destination account not found");const a={fromAccountId:parseInt(s.fromAccountId),toAccountNumber:r.accountNumber,amount:parseFloat(s.amount),description:s.description||"Transfer between own accounts"};console.log("Making internal transfer with data:",a);const p=localStorage.getItem("token"),c=await fetch(`/api/users/${n.id}/transfers`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`},body:JSON.stringify(a)});if(!c.ok){let o="Failed to process transfer";try{const T=await c.json();o=T.message||T.error||o}catch{o=`Error: ${c.status}`}throw new Error(o)}h.success("Transfer between accounts completed successfully!"),f.reset()}catch(r){console.error("Error making transfer:",r),w(r.message||"An unexpected error occurred"),h.error("Transfer failed")}finally{N(!1)}};return e.jsx(re,{children:e.jsxs("div",{className:"flex-1 space-y-4 p-4 pt-6 md:p-8",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Transfer Funds"})}),e.jsxs(Y,{children:[e.jsxs(H,{children:[e.jsx(G,{children:"Money Transfer"}),e.jsx(K,{children:"Transfer money between your accounts or to other accounts"})]}),e.jsxs(Q,{children:[k&&e.jsxs(W,{variant:"destructive",className:"mb-6",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx(Z,{children:k})]}),e.jsxs(se,{value:z,onValueChange:_,className:"w-full",children:[e.jsxs(ne,{className:"grid w-full grid-cols-2",children:[e.jsx(B,{value:"external",children:"External Transfer"}),e.jsx(B,{value:"internal",children:"Between My Accounts"})]}),e.jsx(M,{value:"external",children:e.jsx("div",{className:"mt-6",children:e.jsx(V,{...j,children:e.jsxs("form",{onSubmit:j.handleSubmit(J),className:"space-y-6",children:[e.jsx(i,{control:j.control,name:"fromAccountId",render:({field:s})=>e.jsxs(l,{children:[e.jsx(d,{children:"From Account"}),e.jsxs(S,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(u,{children:e.jsx(v,{children:e.jsx(I,{placeholder:"Select source account"})})}),e.jsx(E,{children:t.map(r=>e.jsxs(F,{value:r.id.toString(),children:[r.type," - ",r.accountNumber," (",C(r.balance),")"]},r.id))})]}),e.jsx(g,{children:"Select the account to transfer from"}),e.jsx(m,{})]})}),e.jsx(i,{control:j.control,name:"toAccountNumber",render:({field:s})=>e.jsxs(l,{children:[e.jsx(d,{children:"To Account Number"}),e.jsx(u,{children:e.jsx(A,{placeholder:"Enter destination account number",...s})}),e.jsx(g,{children:"Enter the recipient's account number"}),e.jsx(m,{})]})}),e.jsx(i,{control:j.control,name:"amount",render:({field:s})=>e.jsxs(l,{children:[e.jsx(d,{children:"Amount (₹)"}),e.jsx(u,{children:e.jsx(A,{type:"number",min:"1",step:"0.01",placeholder:"Enter amount",...s})}),e.jsx(g,{children:"Enter the amount to transfer"}),e.jsx(m,{})]})}),e.jsx(i,{control:j.control,name:"description",render:({field:s})=>e.jsxs(l,{children:[e.jsx(d,{children:"Description (Optional)"}),e.jsx(u,{children:e.jsx(A,{placeholder:"Enter transaction description",...s})}),e.jsx(g,{children:"Add a note for this transfer"}),e.jsx(m,{})]})}),e.jsx("div",{className:"pt-4",children:e.jsxs(D,{type:"submit",className:"w-full",disabled:y||t.length===0,children:[y?"Processing...":"Transfer Funds",e.jsx(O,{className:"ml-2 h-4 w-4"})]})})]})})})}),e.jsx(M,{value:"internal",children:e.jsx("div",{className:"mt-6",children:e.jsx(V,{...f,children:e.jsxs("form",{onSubmit:f.handleSubmit(R),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(i,{control:f.control,name:"fromAccountId",render:({field:s})=>e.jsxs(l,{children:[e.jsx(d,{children:"From Account"}),e.jsxs(S,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(u,{children:e.jsx(v,{children:e.jsx(I,{placeholder:"Select source account"})})}),e.jsx(E,{children:t.map(r=>e.jsxs(F,{value:r.id.toString(),children:[r.type," - ",r.accountNumber," (",C(r.balance),")"]},r.id))})]}),e.jsx(m,{})]})}),e.jsx(i,{control:f.control,name:"toAccountId",render:({field:s})=>e.jsxs(l,{children:[e.jsx(d,{children:"To Account"}),e.jsxs(S,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(u,{children:e.jsx(v,{children:e.jsx(I,{placeholder:"Select destination account"})})}),e.jsx(E,{children:t.map(r=>e.jsxs(F,{value:r.id.toString(),children:[r.type," - ",r.accountNumber," (",C(r.balance),")"]},r.id))})]}),e.jsx(m,{})]})})]}),e.jsx(i,{control:f.control,name:"amount",render:({field:s})=>e.jsxs(l,{children:[e.jsx(d,{children:"Amount (₹)"}),e.jsx(u,{children:e.jsx(A,{type:"number",min:"1",step:"0.01",placeholder:"Enter amount",...s})}),e.jsx(g,{children:"Enter the amount to transfer"}),e.jsx(m,{})]})}),e.jsx(i,{control:f.control,name:"description",render:({field:s})=>e.jsxs(l,{children:[e.jsx(d,{children:"Description (Optional)"}),e.jsx(u,{children:e.jsx(A,{placeholder:"Enter transaction description",...s})}),e.jsx(g,{children:"Add a note for this transfer"}),e.jsx(m,{})]})}),e.jsx("div",{className:"pt-4",children:e.jsxs(D,{type:"submit",className:"w-full",disabled:y||t.length<2,children:[y?"Processing...":"Transfer Between Accounts",e.jsx(O,{className:"ml-2 h-4 w-4"})]})})]})})})})]})]}),e.jsx(U,{className:"flex items-center justify-between",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Transfers are processed instantly during banking hours"})})]})]})})};export{Ne as default};
