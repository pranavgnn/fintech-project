import{j as e,C as I,a as T,b as B,c as k,d as L,B as f}from"./ui-DCtcd1Kk.js";import{r as n,u as F}from"./router-C32cmwfs.js";import{A as D}from"./AdminLayout-Dt8VV5pt.js";import{T as R,a as $,b as x,c as l,d as H,e as c}from"./table-D9jKlXO1.js";import{I as V}from"./input-DjdrYohH.js";import{B as u}from"./badge-CCKXs842.js";import{t as z}from"./index-XEsyHGvM.js";import{S as G}from"./search-T1dYjenp.js";import{E as O}from"./eye-BZq8TSu9.js";import"./charts-BMSya-r6.js";import"./react-Csw2ODfV.js";import"./utils-DCNUdSfE.js";import"./Sidebar-CR8TwwPA.js";import"./RootLayout-Bf31PLGy.js";import"./gift-41HnvwwA.js";const ae=()=>{const[m,N]=n.useState([]),[p,h]=n.useState([]),[b,j]=n.useState(!0),[i,g]=n.useState(""),y=F();n.useEffect(()=>{w()},[]),n.useEffect(()=>{if(i.trim()==="")h(m);else{const s=i.toLowerCase();h(m.filter(r=>{var d,a,t,o;return((d=r.accountNumber)==null?void 0:d.toLowerCase().includes(s))||((a=r.type)==null?void 0:a.toLowerCase().includes(s))||((t=r.userName)==null?void 0:t.toLowerCase().includes(s))||((o=r.userEmail)==null?void 0:o.toLowerCase().includes(s))}))}},[i,m]);const w=async()=>{try{j(!0);const s=localStorage.getItem("token"),r=await fetch("/api/users",{headers:{Authorization:`Bearer ${s}`}});if(!r.ok)throw new Error(`Failed to fetch users: ${r.status}`);const d=await r.json(),a=[];for(const t of d){const o=await fetch(`/api/users/${t.id}/accounts`,{headers:{Authorization:`Bearer ${s}`}});if(o.ok){const E=(await o.json()).map(S=>({...S,userId:t.id,userName:t.name,userEmail:t.email}));a.push(...E)}}N(a),h(a)}catch(s){console.error("Error fetching accounts:",s),z.error("Failed to load accounts data")}finally{j(!1)}},A=s=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(s),v=s=>{y(`/admin/users/${s}`)},C=s=>{switch(s){case"SAVINGS":return e.jsx(u,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:"Savings"});case"CHECKING":return e.jsx(u,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"Checking"});case"FIXED_DEPOSIT":return e.jsx(u,{variant:"outline",className:"bg-purple-50 text-purple-700 border-purple-200",children:"Fixed Deposit"});default:return e.jsx(u,{variant:"outline",children:s})}};return e.jsx(D,{children:e.jsxs("div",{className:"flex-1 space-y-4 p-6 md:p-8",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Accounts Management"})}),e.jsxs(I,{children:[e.jsxs(T,{children:[e.jsx(B,{children:"All Accounts"}),e.jsx(k,{children:"View and manage all user accounts in the system"})]}),e.jsxs(L,{children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(G,{className:"absolute left-2 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(V,{placeholder:"Search by account number, type, or user...",value:i,onChange:s=>g(s.target.value),className:"pl-8"})]}),e.jsx("div",{className:"ml-2",children:e.jsx(f,{disabled:!0,children:"Export Accounts"})})]}),b?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"})}):e.jsx("div",{className:"rounded-md border",children:e.jsxs(R,{children:[e.jsx($,{children:e.jsxs(x,{children:[e.jsx(l,{children:"Account Number"}),e.jsx(l,{children:"Type"}),e.jsx(l,{children:"Balance"}),e.jsx(l,{children:"Owner"}),e.jsx(l,{className:"text-right",children:"Actions"})]})}),e.jsx(H,{children:p.length===0?e.jsx(x,{children:e.jsx(c,{colSpan:5,className:"text-center py-4",children:i?"No accounts found matching your search":"No accounts found"})}):p.map(s=>e.jsxs(x,{children:[e.jsx(c,{className:"font-medium",children:s.accountNumber}),e.jsx(c,{children:C(s.type)}),e.jsx(c,{children:A(s.balance)}),e.jsx(c,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.userName||"Unknown"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.userEmail||"No email"})]})}),e.jsx(c,{className:"text-right",children:e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>v(s.userId),title:"View user details",children:e.jsx(O,{className:"h-4 w-4"})})})]},s.id))})]})})]})]})]})})};export{ae as default};
