import{j as e,f as fe,B as j,C as A,a as P,c as L,b as E,d as je}from"./ui-DCtcd1Kk.js";import{r as i,c as ge,u as ye}from"./router-C32cmwfs.js";import{u as Ne,t as V}from"./index-XEsyHGvM.js";import{D as be}from"./DashboardLayout-gnvqe74Z.js";import{I as ve}from"./input-DjdrYohH.js";import{B as F}from"./badge-CCKXs842.js";import{S as I,a as $,b as z,c as B,d as m}from"./select-gkOMAzdD.js";import{f as q}from"./formatters-CGbyXkBS.js";import{c as l,f as O,p as we}from"./utils-DCNUdSfE.js";import{b as Ce,C as Te,a as ke}from"./calendar-BH1FcBMN.js";import{C as Se}from"./chevron-right-AcBWCHTh.js";import{T as De,a as Ae,b as ae,c as v,d as Pe,e as w}from"./table-D9jKlXO1.js";import{c as U,P as Le,a as Ee,b as Fe}from"./RootLayout-Bf31PLGy.js";import{R as Ie,T as $e,C as ze,a as Be,b as Oe,P as Re,O as _e}from"./index-Csad-dEI.js";import{S as He}from"./search-T1dYjenp.js";import{A as ne,a as re}from"./arrow-up-Beua0blQ.js";import"./charts-BMSya-r6.js";import"./react-Csw2ODfV.js";import"./Sidebar-CR8TwwPA.js";import"./arrow-right-left-DbfiJvWz.js";/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],Ve=U("download",Me);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]],Ge=U("sliders-horizontal",qe);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Qe=U("x",Ue);function Xe({className:n,...o}){return e.jsx("nav",{role:"navigation","aria-label":"pagination","data-slot":"pagination",className:l("mx-auto flex w-full justify-center",n),...o})}function Je({className:n,...o}){return e.jsx("ul",{"data-slot":"pagination-content",className:l("flex flex-row items-center gap-1",n),...o})}function G({...n}){return e.jsx("li",{"data-slot":"pagination-item",...n})}function Q({className:n,isActive:o,size:c="icon",...s}){return e.jsx("a",{"aria-current":o?"page":void 0,"data-slot":"pagination-link","data-active":o,className:l(fe({variant:o?"outline":"ghost",size:c}),n),...s})}function Ke({className:n,...o}){return e.jsxs(Q,{"aria-label":"Go to previous page",size:"default",className:l("gap-1 px-2.5 sm:pl-2.5",n),...o,children:[e.jsx(Ce,{}),e.jsx("span",{className:"hidden sm:block",children:"Previous"})]})}function We({className:n,...o}){return e.jsxs(Q,{"aria-label":"Go to next page",size:"default",className:l("gap-1 px-2.5 sm:pr-2.5",n),...o,children:[e.jsx("span",{className:"hidden sm:block",children:"Next"}),e.jsx(Se,{})]})}function Ye({className:n,dateRange:o,onDateRangeChange:c}){const[s,C]=i.useState(o);i.useEffect(()=>{C(o)},[o]);const T=k=>{C(k),c&&c(k)};return e.jsx("div",{className:l("grid gap-2",n),children:e.jsxs(Le,{children:[e.jsx(Ee,{asChild:!0,children:e.jsxs(j,{id:"date",variant:"outline",className:l("w-full justify-start text-left font-normal",!s&&"text-muted-foreground"),children:[e.jsx(Te,{className:"mr-2 h-4 w-4"}),s!=null&&s.from?s.to?e.jsxs(e.Fragment,{children:[O(s.from,"LLL dd, y")," -"," ",O(s.to,"LLL dd, y")]}):O(s.from,"LLL dd, y"):e.jsx("span",{children:"Pick a date range"})]})}),e.jsx(Fe,{className:"w-auto p-0",align:"start",children:e.jsx(ke,{mode:"range",selected:s&&s.from&&s.to?{from:s.from,to:s.to}:void 0,onRangeChange:T})})]})})}function Ze({...n}){return e.jsx(Ie,{"data-slot":"sheet",...n})}function et({...n}){return e.jsx($e,{"data-slot":"sheet-trigger",...n})}function tt({...n}){return e.jsx(Re,{"data-slot":"sheet-portal",...n})}function st({className:n,...o}){return e.jsx(_e,{"data-slot":"sheet-overlay",className:l("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",n),...o})}function at({className:n,children:o,side:c="right",...s}){return e.jsxs(tt,{children:[e.jsx(st,{}),e.jsxs(ze,{"data-slot":"sheet-content",className:l("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500",c==="right"&&"data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm",c==="left"&&"data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm",c==="top"&&"data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b",c==="bottom"&&"data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",n),...s,children:[o,e.jsxs(Be,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none",children:[e.jsx(Qe,{className:"size-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function nt({className:n,...o}){return e.jsx("div",{"data-slot":"sheet-header",className:l("flex flex-col gap-1.5 p-4",n),...o})}function rt({className:n,...o}){return e.jsx(Oe,{"data-slot":"sheet-title",className:l("text-foreground font-semibold",n),...o})}const kt=()=>{const{user:n}=Ne(),{accountId:o}=ge(),c=ye(),[s,C]=i.useState(null),[T,k]=i.useState([]),[S,oe]=i.useState([]),[ie,X]=i.useState(!0),[J,K]=i.useState(null),[g,W]=i.useState(""),[h,R]=i.useState("timestamp"),[x,D]=i.useState("desc"),[y,_]=i.useState("all"),[d,Y]=i.useState(void 0),[p,H]=i.useState(1),M=10;i.useEffect(()=>{!n||!o||(ce(),Z())},[n,o]),i.useEffect(()=>{let t=[...T];if(g){const a=g.toLowerCase();t=t.filter(r=>r.description&&r.description.toLowerCase().includes(a)||r.fromAccountNumber&&r.fromAccountNumber.includes(a)||r.toAccountNumber&&r.toAccountNumber.includes(a))}y==="incoming"?t=t.filter(a=>a.toAccountNumber===(s==null?void 0:s.accountNumber)):y==="outgoing"&&(t=t.filter(a=>a.fromAccountNumber===(s==null?void 0:s.accountNumber))),d!=null&&d.from&&(t=t.filter(a=>new Date(a.timestamp)>=d.from)),d!=null&&d.to&&(t=t.filter(a=>{const r=new Date(a.timestamp),N=new Date(d.to);return N.setDate(N.getDate()+1),r<N})),t.sort((a,r)=>h==="timestamp"?x==="asc"?new Date(a.timestamp).getTime()-new Date(r.timestamp).getTime():new Date(r.timestamp).getTime()-new Date(a.timestamp).getTime():h==="amount"?x==="asc"?a.amount-r.amount:r.amount-a.amount:0),oe(t)},[T,g,h,x,y,d,s]);const ce=async()=>{try{const t=localStorage.getItem("token"),a=await fetch(`/api/users/${n.id}/accounts/${o}`,{headers:{Authorization:`Bearer ${t}`}});if(!a.ok)throw new Error(`Error: ${a.status}`);const r=await a.json();C(r)}catch(t){console.error("Error fetching account details:",t),V.error("Failed to load account details"),K("Could not load account details")}},Z=async()=>{X(!0);try{const t=localStorage.getItem("token"),a=await fetch(`/api/users/${n.id}/accounts/${o}/transactions`,{headers:{Authorization:`Bearer ${t}`}});if(!a.ok)throw new Error(`Error: ${a.status}`);const r=await a.json();k(r)}catch(t){console.error("Error fetching transactions:",t),V.error("Failed to load transactions"),K("Could not load transactions")}finally{X(!1)}},ee=t=>{h===t?D(x==="asc"?"desc":"asc"):(R(t),D("desc"))},le=()=>{W(""),R("timestamp"),D("desc"),_("all"),Y(void 0)},te=p*M,de=te-M,me=S.slice(de,te),u=Math.ceil(S.length/M),ue=t=>{switch(t){case"COMPLETED":return e.jsx(F,{className:"bg-green-500",children:"Completed"});case"PENDING":return e.jsx(F,{variant:"outline",className:"text-amber-500 border-amber-500",children:"Pending"});case"FAILED":return e.jsx(F,{variant:"destructive",children:"Failed"});default:return e.jsx(F,{variant:"outline",children:t})}},se=t=>{try{return O(we(t),"PPp")}catch{return"Invalid date"}},he=()=>{const a=[["Date","Type","Description","Amount","Status"].join(","),...S.map(b=>{const xe=b.toAccountNumber===(s==null?void 0:s.accountNumber)?"Credit":"Debit",pe=q(b.amount);return[se(b.timestamp),xe,b.description||"Transaction",pe,b.status].join(",")})].join(`
`),r=new Blob([a],{type:"text/csv;charset=utf-8;"}),N=URL.createObjectURL(r),f=document.createElement("a");f.setAttribute("href",N),f.setAttribute("download",`transactions_${s==null?void 0:s.accountNumber}.csv`),f.style.visibility="hidden",document.body.appendChild(f),f.click(),document.body.removeChild(f),V.success("Transactions exported successfully!")};return e.jsx(be,{children:e.jsxs("div",{className:"flex-1 space-y-4 p-4 pt-6 md:p-8",children:[e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Account Transactions"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:he,children:[e.jsx(Ve,{className:"mr-2 h-4 w-4"}),"Export"]}),e.jsx(j,{variant:"default",size:"sm",onClick:()=>c("/transfer"),children:"New Transfer"})]})]}),s&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsx(A,{children:e.jsxs(P,{className:"pb-2",children:[e.jsx(L,{children:"Account Number"}),e.jsx(E,{children:s.accountNumber})]})}),e.jsx(A,{children:e.jsxs(P,{className:"pb-2",children:[e.jsx(L,{children:"Account Type"}),e.jsx(E,{children:s.type})]})}),e.jsx(A,{children:e.jsxs(P,{className:"pb-2",children:[e.jsx(L,{children:"Current Balance"}),e.jsx(E,{children:q(s.balance)})]})})]}),e.jsxs(A,{children:[e.jsx(P,{children:e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx(E,{children:"Transaction History"}),e.jsx(L,{children:"View all transactions for this account"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(He,{className:"absolute left-2 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(ve,{placeholder:"Search transactions...",className:"pl-8 w-full md:w-[200px] lg:w-[300px]",value:g,onChange:t=>W(t.target.value)})]}),e.jsxs(I,{value:y,onValueChange:t=>_(t),children:[e.jsx($,{className:"w-full md:w-[150px]",children:e.jsx(z,{placeholder:"Type"})}),e.jsxs(B,{children:[e.jsx(m,{value:"all",children:"All Transactions"}),e.jsx(m,{value:"incoming",children:"Incoming"}),e.jsx(m,{value:"outgoing",children:"Outgoing"})]})]}),e.jsxs(Ze,{children:[e.jsx(et,{asChild:!0,children:e.jsxs(j,{variant:"outline",size:"sm",children:[e.jsx(Ge,{className:"mr-2 h-4 w-4"}),"Filters"]})}),e.jsxs(at,{children:[e.jsx(nt,{children:e.jsx(rt,{children:"Filter Transactions"})}),e.jsxs("div",{className:"mt-6 px-1 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Date Range"}),e.jsx(Ye,{dateRange:d,onDateRangeChange:Y})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Transaction Type"}),e.jsxs(I,{value:y,onValueChange:t=>_(t),children:[e.jsx($,{children:e.jsx(z,{placeholder:"Select type"})}),e.jsxs(B,{children:[e.jsx(m,{value:"all",children:"All Transactions"}),e.jsx(m,{value:"incoming",children:"Incoming"}),e.jsx(m,{value:"outgoing",children:"Outgoing"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Sort By"}),e.jsxs(I,{value:h,onValueChange:R,children:[e.jsx($,{children:e.jsx(z,{placeholder:"Sort by"})}),e.jsxs(B,{children:[e.jsx(m,{value:"timestamp",children:"Date"}),e.jsx(m,{value:"amount",children:"Amount"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Sort Direction"}),e.jsxs(I,{value:x,onValueChange:t=>D(t),children:[e.jsx($,{children:e.jsx(z,{placeholder:"Sort direction"})}),e.jsxs(B,{children:[e.jsx(m,{value:"asc",children:"Ascending"}),e.jsx(m,{value:"desc",children:"Descending"})]})]})]}),e.jsx(j,{onClick:le,variant:"outline",className:"w-full mt-8",children:"Reset Filters"})]})]})]})]})]})}),e.jsx(je,{children:ie?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"})}):J?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:J}),e.jsx(j,{variant:"outline",size:"sm",onClick:Z,className:"mt-2",children:"Try Again"})]}):S.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e.jsxs("p",{children:["No transactions found",g&&" matching your search"]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs(De,{children:[e.jsx(Ae,{children:e.jsxs(ae,{children:[e.jsxs(v,{className:"cursor-pointer hover:text-primary",onClick:()=>ee("timestamp"),children:["Date",h==="timestamp"&&(x==="asc"?e.jsx(ne,{className:"inline-block ml-1 h-4 w-4"}):e.jsx(re,{className:"inline-block ml-1 h-4 w-4"}))]}),e.jsx(v,{children:"Description"}),e.jsx(v,{children:"From / To"}),e.jsxs(v,{className:"cursor-pointer hover:text-primary",onClick:()=>ee("amount"),children:["Amount",h==="amount"&&(x==="asc"?e.jsx(ne,{className:"inline-block ml-1 h-4 w-4"}):e.jsx(re,{className:"inline-block ml-1 h-4 w-4"}))]}),e.jsx(v,{children:"Status"})]})}),e.jsx(Pe,{children:me.map(t=>{const a=t.toAccountNumber===(s==null?void 0:s.accountNumber);return e.jsxs(ae,{children:[e.jsx(w,{className:"whitespace-nowrap",children:se(t.timestamp)}),e.jsx(w,{children:t.description||"Transaction"}),e.jsx(w,{children:a?t.fromAccountNumber?`From: ${t.fromAccountNumber}`:"External Credit":t.toAccountNumber?`To: ${t.toAccountNumber}`:"External Debit"}),e.jsxs(w,{className:`font-medium whitespace-nowrap ${a?"text-green-600":"text-red-600"}`,children:[a?"+":"-",q(t.amount)]}),e.jsx(w,{children:ue(t.status)})]},t.id)})})]})}),u>1&&e.jsx(Xe,{className:"mt-4",children:e.jsxs(Je,{children:[e.jsx(G,{children:e.jsx(Ke,{onClick:()=>H(t=>Math.max(1,t-1)),className:p===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:Math.min(5,u)},(t,a)=>{let r;return u<=5||p<=3?r=a+1:p>=u-2?r=u-4+a:r=p-2+a,r<=u?e.jsx(G,{children:e.jsx(Q,{onClick:()=>H(r),isActive:p===r,children:r})},r):null}),e.jsx(G,{children:e.jsx(We,{onClick:()=>H(t=>Math.min(u,t+1)),className:p===u?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})})]})]})})};export{kt as default};
