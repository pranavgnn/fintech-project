import{j as e,B as b,C as j,a as N,d as p,b as v,c as R}from"./ui-DCtcd1Kk.js";import{L as D,r as d,u as z}from"./router-C32cmwfs.js";import{u as L,t as O}from"./index-XEsyHGvM.js";import{D as P}from"./DashboardLayout-gnvqe74Z.js";import{T as M,a as V,b as S,c as k,d as _,e as C}from"./table-D9jKlXO1.js";import{S as l}from"./skeleton-BbxErKBh.js";import{P as B}from"./plus-CCzr7Ia9.js";import{C as H}from"./chevron-right-AcBWCHTh.js";import{c as $}from"./utils-DCNUdSfE.js";import{A as q,a as U}from"./arrow-up-Beua0blQ.js";import{B as Y}from"./badge-CCKXs842.js";import{c as I,C as F}from"./RootLayout-Bf31PLGy.js";import{A as G}from"./arrow-up-down-By2ahnEk.js";import{G as Q}from"./gift-41HnvwwA.js";import"./charts-BMSya-r6.js";import"./react-Csw2ODfV.js";import"./Sidebar-CR8TwwPA.js";import"./arrow-right-left-DbfiJvWz.js";/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M17.5 17.5 16 16.3V14",key:"akvzfd"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]],K=I("calendar-clock",J);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 18V6",key:"zqpxq5"}]],X=I("circle-dollar-sign",W);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]],ee=I("percent",Z),se=s=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2,maximumFractionDigits:2}).format(s),te=({accounts:s,isLoading:c,error:m})=>c?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(o=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(l,{className:"h-12 w-12 rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"h-4 w-[250px]"}),e.jsx(l,{className:"h-4 w-[200px]"})]})]},o))}):m?e.jsxs("div",{className:"text-center py-6",children:[e.jsx("p",{className:"text-muted-foreground",children:m}),e.jsx(b,{variant:"outline",className:"mt-4",onClick:()=>window.location.reload(),children:"Try Again"})]}):s.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx("p",{className:"text-muted-foreground",children:"You don't have any accounts yet."}),e.jsx(b,{asChild:!0,className:"mt-4",children:e.jsxs(D,{to:"/accounts/create",children:[e.jsx(B,{className:"mr-2 h-4 w-4"})," Create Your First Account"]})})]}):e.jsxs("div",{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(M,{children:[e.jsx(V,{children:e.jsxs(S,{children:[e.jsx(k,{children:"Account Type"}),e.jsx(k,{children:"Account Number"}),e.jsx(k,{children:"Balance"}),e.jsx(k,{})]})}),e.jsx(_,{children:s.map(o=>e.jsxs(S,{children:[e.jsx(C,{className:"font-medium",children:o.accountType}),e.jsx(C,{children:o.accountNumber}),e.jsx(C,{children:se(o.balance)}),e.jsx(C,{children:e.jsx(b,{variant:"ghost",size:"sm",asChild:!0,children:e.jsx(D,{to:`/accounts/${o.id}`,children:e.jsx(H,{className:"h-4 w-4"})})})})]},o.id))})]})}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(b,{asChild:!0,variant:"outline",size:"sm",children:e.jsxs(D,{to:"/accounts/create",children:[e.jsx(B,{className:"mr-2 h-4 w-4"})," Create New Account"]})})})]}),re=s=>{if(!s)return"N/A";try{const c=new Date(s);return isNaN(c.getTime())?(console.warn("Invalid date encountered:",s),"N/A"):new Intl.DateTimeFormat("en-IN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(c)}catch(c){return console.error("Error formatting date:",c,s),"N/A"}},ae=s=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2,maximumFractionDigits:2}).format(s),ce=({userId:s,accounts:c=[]})=>{const[m,o]=d.useState([]),[A,x]=d.useState(!0),[g,y]=d.useState(null);d.useEffect(()=>{s&&c.length>0?w():x(!1)},[s,c]);const w=async()=>{if(!s||c.length===0){x(!1);return}try{x(!0),y(null);const t=localStorage.getItem("token");console.log("Fetching transactions for user:",s);try{const r=await fetch(`/api/users/${s}/transactions`,{headers:{Authorization:`Bearer ${t}`}});if(r.ok){const n=await r.json();console.log("All user transactions:",n);const T=Array.isArray(n)?n:[];o(T),x(!1);return}else console.warn("Could not fetch all transactions:",r.status)}catch(r){console.warn("All transactions API failed:",r)}console.log("Falling back to per-account transactions");const i=c.map(async r=>{try{const n=await fetch(`/api/users/${s}/accounts/${r.id}/transactions`,{headers:{Authorization:`Bearer ${t}`}});if(!n.ok)return console.warn(`Failed to fetch transactions for account ${r.id}. Status: ${n.status}`),[];const T=await n.json();return Array.isArray(T)?T.map(E=>({...E,accountNumber:r.accountNumber||r.id.toString()})):[]}catch(n){return console.warn(`Error fetching transactions for account ${r.id}:`,n),[]}}),u=(await Promise.all(i)).flat().filter(r=>r&&(typeof r.amount=="number"||typeof r.amount=="string")).sort((r,n)=>{const T=r.timestamp?new Date(r.timestamp).getTime():r.createdAt?new Date(r.createdAt).getTime():0;return(n.timestamp?new Date(n.timestamp).getTime():n.createdAt?new Date(n.createdAt).getTime():0)-T}).slice(0,5);console.log("Processed transactions:",u),o(u)}catch(t){console.error("Error fetching transactions:",t),y("Could not load recent transactions")}finally{x(!1)}};if(A)return e.jsx("div",{className:"space-y-4",children:[1,2,3].map(t=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{className:"h-9 w-9 rounded-full"}),e.jsxs("div",{children:[e.jsx(l,{className:"h-4 w-[120px] mb-1"}),e.jsx(l,{className:"h-3 w-[80px]"})]})]}),e.jsx(l,{className:"h-4 w-[80px]"})]},t))});if(g)return e.jsxs("div",{className:"text-center py-6",children:[e.jsx("p",{className:"text-muted-foreground",children:g}),e.jsx(b,{variant:"outline",className:"mt-4",onClick:w,children:"Try Again"})]});if(c.length===0)return e.jsx("div",{className:"text-center py-6 text-muted-foreground",children:"No accounts to display transactions for"});if(m.length===0)return e.jsx("div",{className:"text-center py-6 text-muted-foreground",children:"No transactions found for your accounts"});const a=(t,i)=>t.type?t.type:i.some(u=>u.accountNumber===t.fromAccountNumber)?"DEBIT":"CREDIT",h=t=>t.accountNumber?t.accountNumber:c.some(i=>i.accountNumber===t.fromAccountNumber)?t.toAccountNumber||"N/A":t.fromAccountNumber||"N/A";return e.jsx("div",{className:"space-y-4",children:m.map(t=>{const i=a(t,c),f=t.timestamp||t.createdAt||null,u=h(t);return e.jsxs("div",{className:"flex items-center justify-between pb-3 border-b last:border-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:$("flex items-center justify-center w-9 h-9 rounded-full",i==="DEBIT"?"bg-destructive/10":"bg-green-100"),children:i==="DEBIT"?e.jsx(q,{className:"h-4 w-4 text-destructive"}):e.jsx(U,{className:"h-4 w-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:t.description||(i==="DEBIT"?"Sent":"Received")}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[u," â€¢ ",re(f)]})]})]}),e.jsxs("span",{className:$("font-medium",i==="DEBIT"?"text-destructive":"text-green-600"),children:[i==="DEBIT"?"-":"+",ae(t.amount)]})]},t.id)})})},ne=({onOffersLoaded:s})=>{const[c,m]=d.useState([]),[o,A]=d.useState(!0),[x,g]=d.useState(null);d.useEffect(()=>{y()},[s]);const y=async()=>{try{A(!0),g(null);const a=localStorage.getItem("token"),h=await fetch("/api/offers",{headers:{Authorization:`Bearer ${a}`}});if(!h.ok)throw new Error(`Failed to fetch offers. Status: ${h.status}`);const t=await h.json();m(t),s&&s(t.length)}catch(a){console.error("Error fetching offers:",a),g("Could not load special offers"),s&&s(0)}finally{A(!1)}},w=a=>{const h=new Date(a);return new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(h)};return o?e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Special Offers"}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[1,2,3].map(a=>e.jsxs(j,{className:"flex flex-col",children:[e.jsxs(N,{children:[e.jsx(l,{className:"h-5 w-1/3 mb-2"}),e.jsx(l,{className:"h-4 w-1/4"})]}),e.jsxs(p,{className:"flex-1",children:[e.jsx(l,{className:"h-4 w-full mb-2"}),e.jsx(l,{className:"h-4 w-5/6 mb-2"}),e.jsx(l,{className:"h-4 w-3/4"})]}),e.jsx("div",{className:"p-6 pt-0 mt-auto",children:e.jsx(l,{className:"h-10 w-full"})})]},a))})]}):x?e.jsxs("div",{className:"text-center py-6",children:[e.jsx("p",{className:"text-muted-foreground",children:x}),e.jsx(b,{variant:"outline",className:"mt-4",onClick:y,children:"Try Again"})]}):c.length===0?e.jsx("div",{className:"text-center py-6 text-muted-foreground",children:"No special offers available at this time"}):e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Special Offers"}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:c.map(a=>e.jsxs(j,{className:"flex flex-col",children:[e.jsxs(N,{children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(v,{children:a.title}),e.jsx(Y,{variant:a.category==="Transfer"?"outline":a.category==="Savings"?"secondary":"default",children:a.category})]}),e.jsxs(R,{className:"flex items-center mt-2",children:[e.jsx(K,{className:"h-4 w-4 mr-1"}),"Valid until ",w(a.validUntil)]})]}),e.jsxs(p,{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:a.description}),a.discount&&e.jsxs("div",{className:"mt-4 flex items-center",children:[a.category==="Credit Card"?e.jsx(F,{className:"h-5 w-5 mr-2 text-primary"}):e.jsx(ee,{className:"h-5 w-5 mr-2 text-primary"}),e.jsx("span",{className:"font-bold",children:a.discount})]})]}),e.jsx("div",{className:"p-6 pt-0 mt-auto",children:e.jsx(b,{className:"w-full",children:"View Details"})})]},a.id))})]})},oe=s=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2,maximumFractionDigits:2}).format(s),ke=()=>{const{user:s}=L(),c=z(),[m,o]=d.useState([]),[A,x]=d.useState(!0),[g,y]=d.useState(null),[w,a]=d.useState(0);d.useEffect(()=>{(async()=>{if(s)try{x(!0);const u=localStorage.getItem("token");console.log("Fetching accounts for user:",s.id);const r=await fetch(`/api/users/${s.id}/accounts`,{headers:{Authorization:`Bearer ${u}`}});if(r.ok){const n=await r.json();console.log("Accounts fetched successfully:",n),o(n)}else if(console.error(`Failed to fetch accounts. Status: ${r.status}`),r.status===404)o([]);else throw new Error(`Error: ${r.status} ${r.statusText}`)}catch(u){console.error("Error fetching accounts:",u),y("Could not load accounts. Please try again later."),O.error("Failed to load account data")}finally{x(!1)}})()},[s]);const h=m.reduce((f,u)=>f+u.balance,0),t=f=>{a(f)},i=()=>{c("/transfer")};return e.jsx(P,{children:e.jsxs("div",{className:"flex-1 space-y-4 p-4 pt-6 md:p-8",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Dashboard"})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(j,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium",children:"Total Balance"}),e.jsx(X,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:oe(h)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Across all accounts"})]})]}),e.jsxs(j,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium",children:"Total Accounts"}),e.jsx(F,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:m.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Active accounts"})]})]}),e.jsxs(j,{className:"cursor-pointer transition-colors hover:bg-muted/50",onClick:i,children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium",children:"Quick Transfer"}),e.jsx(G,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"Transfer"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Between your accounts"})]})]}),e.jsxs(j,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium",children:"Special Offers"}),e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(p,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[w," ",w===1?"Offer":"Offers"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Exclusive banking offers"})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-7",children:[e.jsxs(j,{className:"col-span-4",children:[e.jsx(N,{children:e.jsx(v,{children:"Your Accounts"})}),e.jsx(p,{children:e.jsx(te,{accounts:m,isLoading:A,error:g})})]}),e.jsxs(j,{className:"col-span-3",children:[e.jsx(N,{children:e.jsx(v,{children:"Recent Transactions"})}),e.jsx(p,{children:e.jsx(ce,{userId:s==null?void 0:s.id,accounts:m})})]})]}),e.jsx(ne,{onOffersLoaded:t})]})})};export{ke as default};
