import{j as e,C as I,a as w,b as v,c as D,d as E,B as x,e as T}from"./ui-DCtcd1Kk.js";import{u as B,r as j}from"./router-C32cmwfs.js";import{u as k,o as V,s as G,e as O}from"./utils-DCNUdSfE.js";import{A as P,C as $,a as H,F as M,b as f,c as g,d as y,e as S,g as C,f as b,s as _}from"./alert-CsIf4CTI.js";import{D as q}from"./DashboardLayout-gnvqe74Z.js";import{I as K}from"./input-DjdrYohH.js";import{S as L,a as X,b as z,c as J,d as l}from"./select-gkOMAzdD.js";import{u as R,t as u}from"./index-XEsyHGvM.js";import"./charts-BMSya-r6.js";import"./react-Csw2ODfV.js";import"./RootLayout-Bf31PLGy.js";import"./Sidebar-CR8TwwPA.js";import"./arrow-right-left-DbfiJvWz.js";const Y=V({type:O(["SAVINGS","CHECKING","FIXED_DEPOSIT"],{required_error:"Please select an account type"}),initialBalance:G().min(1,"Initial deposit amount is required").refine(n=>{const s=parseFloat(n);return!isNaN(s)&&s>=1e3},{message:"Initial deposit must be at least ₹1000"})}),le=()=>{const{user:n}=R(),s=B(),[d,m]=j.useState(!1),[p,h]=j.useState(null),o=k({resolver:_(Y),defaultValues:{type:"SAVINGS",initialBalance:"1000"}}),N=async t=>{if(!n){u.error("You must be logged in to create an account");return}m(!0),h(null);try{const a={type:t.type,initialBalance:parseFloat(t.initialBalance)};console.log("Creating account with data:",a);const A=localStorage.getItem("token"),r=await fetch(`/api/users/${n.id}/accounts`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${A}`},body:JSON.stringify(a)});if(!r.ok){let c="Failed to create account";try{const i=await r.json();c=i.message||i.error||c}catch{c=`Error ${r.status}: ${r.statusText}`}throw new Error(c)}const F=await r.json();console.log("Account created successfully:",F),u.success("Account created successfully!"),s("/dashboard")}catch(a){console.error("Error creating account:",a),h(a.message||"An unexpected error occurred"),u.error("Failed to create account")}finally{m(!1)}};return e.jsx(q,{children:e.jsxs("div",{className:"flex-1 space-y-4 p-4 pt-6 md:p-8",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Create New Account"})}),e.jsxs(I,{className:"max-w-2xl mx-auto",children:[e.jsxs(w,{children:[e.jsx(v,{children:"New Bank Account"}),e.jsx(D,{children:"Open a new account with FinnBank to manage your finances."})]}),e.jsxs(E,{children:[p&&e.jsxs(P,{variant:"destructive",className:"mb-6",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx(H,{children:p})]}),e.jsx(M,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(N),className:"space-y-6",children:[e.jsx(f,{control:o.control,name:"type",render:({field:t})=>e.jsxs(g,{children:[e.jsx(y,{children:"Account Type"}),e.jsxs(L,{onValueChange:t.onChange,defaultValue:t.value,children:[e.jsx(S,{children:e.jsx(X,{children:e.jsx(z,{placeholder:"Select account type"})})}),e.jsxs(J,{children:[e.jsx(l,{value:"SAVINGS",children:"Savings Account"}),e.jsx(l,{value:"CHECKING",children:"Checking Account"}),e.jsx(l,{value:"FIXED_DEPOSIT",children:"Fixed Deposit"})]})]}),e.jsx(C,{children:"Select the type of account you want to open."}),e.jsx(b,{})]})}),e.jsx(f,{control:o.control,name:"initialBalance",render:({field:t})=>e.jsxs(g,{children:[e.jsx(y,{children:"Initial Deposit (₹)"}),e.jsx(S,{children:e.jsx(K,{type:"number",min:"1000",step:"100",placeholder:"1000",...t})}),e.jsx(C,{children:"Minimum initial deposit is ₹1000."}),e.jsx(b,{})]})}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(x,{type:"submit",disabled:d,className:"ml-auto",children:d?"Creating...":"Create Account"})})]})})]}),e.jsx(T,{className:"flex justify-between",children:e.jsx(x,{variant:"outline",onClick:()=>s("/dashboard"),children:"Cancel"})})]})]})})};export{le as default};
